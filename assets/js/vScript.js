var Vonigo={InputData:null,CallBackFunction:null,NextFunction:null,clientID:null,contactID:null,locationID:null,quoteID:null,paymentID:null,templateID:null,templateSubject:null,templateBody:null,init:function(o){Vonigo.InputData=o,Vonigo.NextFunction=Vonigo.createClient,Vonigo.Security.createToken()},createClient:function(){var o={securityToken:Vonigo.Security.getToken(),method:"3",Fields:[{fieldID:121,optionID:"59"},{fieldID:126,fieldValue:Vonigo.InputData.lastName+" "+Vonigo.InputData.firstName},{fieldID:112,fieldValue:Vonigo.InputData.phoneNo},{fieldID:1091,fieldValue:Vonigo.InputData.email}]};Vonigo.Utils.loadJson("https://gooil.vonigo.com/api/v1/data/Leads/",o,Vonigo.createClientAfter)},createClientAfter:function(o){var e=JSON.parse(o);Vonigo.NextFunction=Vonigo.createContact,Vonigo.clientID=0;try{Vonigo.clientID=e.Client.objectID}catch(o){}Vonigo.Security.validateResponse(Vonigo.clientID,e.errNo,e.errMsg)},createContact:function(){var o={securityToken:Vonigo.Security.getToken(),method:"3",clientID:Vonigo.clientID,Fields:[{fieldID:127,fieldValue:Vonigo.InputData.firstName},{fieldID:128,fieldValue:Vonigo.InputData.lastName},{fieldID:1088,fieldValue:Vonigo.InputData.phoneNo},{fieldID:10322,fieldValue:Vonigo.InputData.email}]};Vonigo.Utils.loadJson("https://gooil.vonigo.com/api/v1/data/Contacts/",o,Vonigo.createContactAfter)},createContactAfter:function(o){var e=JSON.parse(o);Vonigo.NextFunction=Vonigo.createLocation,Vonigo.contactID=0;try{Vonigo.contactID=e.Contact.objectID}catch(o){}Vonigo.Security.validateResponse(Vonigo.contactID,e.errNo,e.errMsg)},createLocation:function(){var o={securityToken:Vonigo.Security.getToken(),method:"3",clientID:Vonigo.clientID,Fields:[{fieldID:779,optionID:9907},{fieldID:778,optionID:Vonigo.Utils.convertProvince(Vonigo.InputData.province)},{fieldID:776,fieldValue:Vonigo.InputData.city},{fieldID:773,fieldValue:Vonigo.InputData.streetAddress},{fieldID:775,fieldValue:Vonigo.InputData.postalCode}]};Vonigo.Utils.loadJson("https://gooil.vonigo.com/api/v1/data/Locations/",o,Vonigo.createLocationAfter)},createLocationAfter:function(o){var e=JSON.parse(o);Vonigo.NextFunction=Vonigo.redirect,Vonigo.locationID=0;try{Vonigo.locationID=e.Location.objectID}catch(o){}Vonigo.Security.validateResponse(Vonigo.locationID,e.errNo,e.errMsg)},redirect:function(){if(1==googleLogin){function o(o,e,n){var t;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),t="; expires="+i.toGMTString()}else t="";document.cookie=escape(o)+"="+escape(e)+t+"; path=/"}o("clientID",Vonigo.clientID,"10"),o("contactID",Vonigo.contactID,"10"),o("locationID",Vonigo.locationID,"10"),window.location.href=redirectURL}},Security:{SECURITY_TOKEN:"securityToken",loginAttempts:0,getToken:function(){return Vonigo.Utils.getCookie(Vonigo.Security.SECURITY_TOKEN)},createToken:function(){var o=Vonigo.Utils.b64DecodeUnicode("aHR0cHM6Ly9nb29pbC52b25pZ28uY29tL2FwaS92MS9zZWN1cml0eS9sb2dpbi8/YXBwVmVyc2lvbj0xJmNvbXBhbnk9Vm9uaWdvJnBhc3N3b3JkPTVmOTIxMzk0ZmFmYWI1MjRiYTQxMTc5YjNlMTdkYmRkJnVzZXJOYW1lPUpvbmF0aGFuLlNwYXJyb3c=");Vonigo.Utils.loadJson(o,"",Vonigo.Security.createTokenAfter)},createTokenAfter:function(vJson){var json=JSON.parse(vJson),securityToken=json.securityToken;0==json.errNo&&securityToken.length>0?(Vonigo.Utils.setCookie(Vonigo.Security.SECURITY_TOKEN,json.securityToken),eval(Vonigo.NextFunction())):Vonigo.Security.callBack(0,json.errNo,json.errMsg)},validateResponse:function(id,num,msg){0==Vonigo.Security.loginAttempts?-421==num&&-422==num?(Vonigo.Security.loginAttempts+=1,Vonigo.Security.createToken()):0!=num?Vonigo.Security.callBack(0,num,msg):(Vonigo.Security.loginAttempts=0,eval(Vonigo.NextFunction())):Vonigo.Security.callBack(0,num,msg)},callBack:function(id,num,msg){var oErr={errNo:num,errMsg:msg,objectID:id};eval(Vonigo.CallBackFunction(oErr))}},Utils:{loadJson:function(apiEndpointUrl,jsonPayload,callBackFunction){jsonPayload=JSON.stringify(jsonPayload);var oXr=new XMLHttpRequest;oXr.open("POST",apiEndpointUrl,!0),oXr.setRequestHeader("Content-Type","application/json"),oXr.onreadystatechange=function(){4==oXr.readyState&&eval(callBackFunction(oXr.responseText))},oXr.send(escape(jsonPayload))},$:function(o){return document.getElementById(o)},getCookie:function(o){var e=document.cookie.indexOf(o+"="),n=e+o.length+1;if(!e&&o!=document.cookie.substring(0,o.length))return null;if(-1==e)return null;var t=document.cookie.indexOf(";",n);return-1==t&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))},setCookie:function(o,e){document.cookie.indexOf(o+"="),document.cookie=o+"="+e},b64DecodeUnicode:function(o){return decodeURIComponent(atob(o).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""))},convertProvince:function(o){switch(o){case"AB":return 9885;case"BC":return 9886;case"MB":return 9833;case"NB":return 9832;case"NL":return 9819;case"NS":return 9818;case"NT":return 9815;case"NU":return 9816;case"ON":return 9884;case"PE":return 9830;case"QC":return 9831;case"SK":return 9886;case"YT":return 9817;default:return 9833}}}};
